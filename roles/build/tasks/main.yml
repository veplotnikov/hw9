---
- name: Create a volume
  docker_volume: name={{ volume_name }}

- name: Creates directory
  file: path={{ app_dir }} state=directory

- name: copy dockerfiles
  synchronize: src={{ app_name }} dest={{ app_dir }}

- name: Build images
  docker_image: 
    name: '{{ item }}' 
    build:
      path: '/{{ app_dir }}/{{ app_name }}/{{ item }}/' 
    source: build
  loop: "{{ images }}"

- name: Run containers
  docker_container:
    name: '{{ item }}'
    image: '{{ item }}'
    volumes:
      - volume_one:/opt/war/  
  loop: "{{ images }}"