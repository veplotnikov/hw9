---
- name: Create a volume
  docker_volume: 
    name: '{{ volume_name }}'

- name: Creates directory
  file: 
    path: '/{{ app_dir }}'
    state: directory

- name: copy dockerfiles
  synchronize:
    src: '{{ app_name }}'
    dest: '/{{ app_dir }}'

- name: Build image maven
  docker_image: 
    name: maven 
    build:
      path: '/{{ app_dir }}/{{ app_name }}/maven/' 
    source: build
  
- name: Run container maven
  docker_container:
    name: maven
    image: maven
    volumes:
      - volume_one:/opt/war/  
    recreate: yes

- name: copy .war 
  shell:
    cmd: cp /var/lib/docker/volumes/volume_one/_data/*.war /app/boxfuse/tomcat/ 

- name: Build image tomcat
  docker_image: 
    name: tomcat
    repository: volodyaaggregion/hw9
    force_tag: yes
    build:
      path: '/{{ app_dir }}/{{ app_name }}/tomcat/' 
    source: build